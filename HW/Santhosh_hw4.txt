Questions

(1) Load all the trips on Aug 1 st (pickup time) between 10am and 11 am in the NYC_Taxi_Aug
table you previously created. Save these trips into a Spark DataFrame. Filter the records and
only keep the records with CSH or CRD payment types. Remove any record with missing values.
You may either issue sql() commands or use spark DataFrame manipulation functions. Save this
DataFrame as “day1_training”.

(2) Train a random forest model using day1_training as the input dataset. The random forest
should be trained to predict the payment type (CSH or CRD) using the following 7 columns:
passenger_count, trip_distance, pickup_longitude, pickup_latitude, dropoff_longitude,
dropoff_latitude, fare_amount. Use 20 trees with maximum tree depth = 5. Save the model as a
variable.

(3) Load the trips on Aug 2 nd (pickup time) between 10am and 11 am from the NYC_taxi_Aug
table and repeat the steps in (1) to generate a new DataFrame called “day2_testing”. Do not
train a new model. Apply the model learned in (2) on this testing dataset to do prediction. Print
the top 20 rows of your prediction output.

(4) Calculate the accuracy of your model on the testing set. The accuracy is calculated as:
number of rows with correct prediction/number of rows in the testing set. If the “prediction”
column has the same value as the “payment_type” column, then this row is predicted correctly.
Print this number and also report this number using an R comment.

(5) Treat CRD as the positive class (“1”) and CSH as the negative class (“0”). Calculate the
precision and recall of the prediction result in (4). Print these two numbers and also report
them using R comment lines in your code.

Q2 (25 pts). Linear Regression.

(1) (10 pts) Use the “day1_training” DataFrame obtained in Q1(1) to train a linear regression
model. Train the model to predict the “trip_distance” column using fare_amount,
pickup_longitude, pickup_latitude, dropoff_latitude, and dropoff_longitude.
(2) (15 pts) Apply the model learned in Q2(1) on the “day2_testing” DataFrame to do a
prediction and calculate the root mean squared error (RMSE) and Mean Absolute Percentage
Error (MAPE) using the output. Print the first 20 rows of prediction result and the RMSE and
MAPE values. Report these two values in your code using an R comment.

Q3. (25 pts) Clustering.
(1) Use the kmeans function in SparkR to cluster the trips in the day1_training DataFrame into
5 clusters. You should only use the following attributes for clustering: pickup_latitude,
pickup_longitude, dropoff_latitude, dropoff_longitude. Fit the learned model on the
day1_training dataframe (same dataset for training and testing). Show the first 20 rows of
the clustering results and report the centroid coordinates of each cluster using R comments.


Q1)
    - sql("use smurugesan")
    - nyc_aug_data <- sql("SELECT * FROM nyc_taxi_aug")
    - first_day_pickup <- sql("SELECT * FROM nyc_taxi_aug where day(pickup_datetime) = 1")
    - Trips_CSH <- where(first_day_pickup, first_day_pickup$payment_type=="CSH")
    - Trips_CRD <- where(first_day_pickup, first_day_pickup$payment_type=="CRD")
    - day1_training = rbind(Trips_CSH, Trips_CRD)
    
    1.2)
    - model <- spark.randomForest(day1_training,  payment_type ~passenger_count +trip_distance +pickup_longitude +pickup_latitude +dropoff_longitude +dropoff_latitude +fare_amount, "classification", numTrees = 20, maxDepth = 5)

    1.3)
    - second_day_pickup <- sql("SELECT * FROM nyc_taxi_aug where day(pickup_datetime) = 2")
    - Trips_CSH <- where(second_day_pickup, second_day_pickup$payment_type=="CSH")
    - Trips_CRD <- where(second_day_pickup, second_day_pickup$payment_type=="CRD")
    - day2_training = rbind(Trips_CSH, Trips_CRD)
    - Output <- predict(model, day2_training)
    - showDF(Output, 20)

First 20 rows
+---------+-------------------+-------------------+---------------+-------------+----------------+---------------+---------+------------------+-----------------+----------------+------------+-----------+---------+-------+----------+------------+------------+--------------------+--------------------+----------+
|vendor_id|    pickup_datetime|   dropoff_datetime|passenger_count|trip_distance|pickup_longitude|pickup_latitude|rate_code|store_and_fwd_flag|dropoff_longitude|dropoff_latitude|payment_type|fare_amount|surcharge|mta_tax|tip_amount|tolls_amount|total_amount|       rawPrediction|         probability|prediction|
+---------+-------------------+-------------------+---------------+-------------+----------------+---------------+---------+------------------+-----------------+----------------+------------+-----------+---------+-------+----------+------------+------------+--------------------+--------------------+----------+
|      CMT|2014-08-02 23:16:34|2014-08-02 23:23:50|              1|          1.3|      -73.980162|      40.743206|        1|                 Y|       -73.965414|       40.755026|         CSH|        7.0|      0.5|    0.5|       0.0|         0.0|         8.0|[12.6341140720381...|[0.63170570360190...|       CRD|
|      CMT|2014-08-02 21:03:59|2014-08-02 21:13:08|              1|          1.0|      -73.994692|      40.727707|        1|                 Y|        -73.98684|        40.73937|         CSH|        7.0|      0.5|    0.5|       0.0|         0.0|         8.0|[12.6546456298037...|[0.63273228149018...|       CRD|
|      CMT|2014-08-02 21:49:18|2014-08-02 21:57:36|              1|          1.6|      -73.982328|      40.773345|        1|                 Y|       -73.960542|        40.77262|         CSH|        8.0|      0.5|    0.5|       0.0|         0.0|         9.0|[11.2762189499532...|[0.56381094749766...|       CRD|
|      CMT|2014-08-02 04:11:34|2014-08-02 04:31:10|              1|          8.6|        -73.9871|      40.733363|        1|                 Y|       -73.938968|       40.821745|         CSH|       26.0|      0.5|    0.5|       0.0|         0.0|        27.0|[12.8776006192284...|[0.64388003096142...|       CRD|
|      CMT|2014-08-02 00:10:14|2014-08-02 00:37:43|              2|          6.0|      -73.980572|      40.767423|        1|                 Y|        -74.01211|       40.707162|         CSH|       23.5|      0.5|    0.5|       0.0|         0.0|        24.5|[12.7177987288646...|[0.63588993644323...|       CRD|
|      CMT|2014-08-02 12:03:57|2014-08-02 12:10:45|              1|          1.5|      -73.978071|      40.754908|        1|                 Y|        -73.99212|        40.74877|         CSH|        6.5|      0.0|    0.5|       0.0|         0.0|         7.0|[11.4343837979088...|[0.57171918989544...|       CRD|
|      CMT|2014-08-02 22:56:28|2014-08-02 22:58:40|              1|          0.7|      -74.007858|      40.723299|        1|                 Y|       -74.007073|       40.732999|         CSH|        4.0|      0.5|    0.5|       0.0|         0.0|         5.0|[10.8937517605827...|[0.54468758802913...|       CRD|
|      CMT|2014-08-02 14:49:31|2014-08-02 14:54:48|              1|          1.2|      -73.985844|      40.756006|        1|                 Y|        -74.00003|       40.755815|         CSH|        5.5|      0.0|    0.5|       0.0|         0.0|         6.0|[10.4717869210612...|[0.52358934605306...|       CRD|
|      CMT|2014-08-02 23:05:14|2014-08-02 23:12:11|              1|          0.9|      -74.000673|      40.742092|        1|                 Y|       -73.986503|       40.739424|         CSH|        6.0|      0.5|    0.5|       0.0|         0.0|         7.0|[12.5238643387779...|[0.62619321693889...|       CRD|
|      CMT|2014-08-02 00:11:02|2014-08-02 00:17:05|              2|          0.7|      -74.001644|      40.730565|        1|                 Y|       -73.998973|       40.739193|         CSH|        6.0|      0.5|    0.5|       0.0|         0.0|         7.0|[12.5238643387779...|[0.62619321693889...|       CRD|
|      CMT|2014-08-02 16:40:32|2014-08-02 17:07:01|              2|          6.8|      -74.013702|      40.714131|        1|                 Y|       -73.982338|       40.777179|         CSH|       21.5|      0.0|    0.5|       0.0|         0.0|        22.0|[12.8351724524456...|[0.64175862262228...|       CRD|
|      CMT|2014-08-02 14:01:19|2014-08-02 14:11:37|              1|          2.9|      -73.984795|      40.747944|        1|                 Y|        -73.96148|       40.777266|         CSH|       10.5|      0.0|    0.5|       0.0|         0.0|        11.0|[12.7775922982449...|[0.63887961491224...|       CRD|
|      CMT|2014-08-02 01:10:13|2014-08-02 01:19:23|              1|          4.6|      -73.987059|      40.720721|        1|                 Y|       -73.956198|       40.767076|         CSH|       14.5|      0.5|    0.5|       0.0|         0.0|        15.5|[13.0045987230028...|[0.65022993615014...|       CRD|
|      CMT|2014-08-02 15:01:07|2014-08-02 15:18:39|              3|          3.0|      -73.995664|      40.759424|        1|                 Y|       -73.972409|        40.76161|         CSH|       12.0|      0.0|    0.5|       0.0|         0.0|        12.5|[12.1323629749466...|[0.60661814874733...|       CRD|
|      CMT|2014-08-02 16:06:23|2014-08-02 16:10:10|              1|          0.9|      -73.987204|      40.750836|        1|                 Y|       -73.979533|       40.761271|         CSH|        5.0|      0.0|    0.5|       0.0|         0.0|         5.5|[9.71616517921341...|[0.48580825896067...|       CSH|
|      CMT|2014-08-02 13:19:56|2014-08-02 13:27:22|              4|          1.5|      -74.013055|      40.716384|        1|                 Y|       -74.016966|       40.707525|         CSH|        6.5|      0.0|    0.5|       0.0|         0.0|         7.0|[12.9396823762249...|[0.64698411881124...|       CRD|
|      CMT|2014-08-02 21:37:15|2014-08-02 21:41:58|              1|          0.9|       -73.98658|      40.766799|        1|                 Y|       -73.987686|       40.776491|         CSH|        5.5|      0.5|    0.5|       0.0|         0.0|         6.5|[9.77830156016073...|[0.48891507800803...|       CSH|
|      CMT|2014-08-02 12:28:18|2014-08-02 12:33:25|              1|          1.0|      -73.988378|      40.749039|        1|                 Y|       -73.979689|       40.752643|         CSH|        5.5|      0.0|    0.5|       0.0|         0.0|         6.0|[9.91672194815965...|[0.49583609740798...|       CSH|
|      CMT|2014-08-02 11:49:09|2014-08-02 12:00:03|              2|          1.7|      -73.989825|      40.761487|        1|                 Y|       -73.977704|        40.75397|         CSH|        8.0|      0.0|    0.5|       0.0|         0.0|         8.5|[10.5487642906137...|[0.52743821453068...|       CRD|
|      CMT|2014-08-02 15:32:46|2014-08-02 15:46:48|              2|          3.1|      -73.962289|       40.77917|        1|                 Y|       -73.977804|       40.753746|         CSH|       11.0|      0.0|    0.5|       0.0|         0.0|        11.5|[12.1323629749466...|[0.60661814874733...|       CRD|
+---------+-------------------+-------------------+---------------+-------------+----------------+---------------+---------+------------------+-----------------+----------------+------------+-----------+---------+-------+----------+------------+------------+--------------------+--------------------+----------+
only showing top 20 rows


    1.4)
    - Correct <- nrow(where(Output, Output$payment_type == Output$prediction))
	- Total <- nrow(Output)
	- Accuracy = Correct/Total 
	- cat("accuracy of the model = ", Accuracy)
	#accuracy of the model =  0.5801128

	1.5)
	- day1_training$payment_type <- ifelse(day1_training$payment_type =='CRD', 1, 0)
    - day2_training$payment_type <- ifelse(day2_training$payment_type =='CRD', 1, 0)
    - model <- spark.randomForest(day1_training,  payment_type ~passenger_count +trip_distance +pickup_longitude +pickup_latitude +dropoff_longitude +dropoff_latitude +fare_amount, "classification", numTrees = 20, maxDepth = 5)
    - Output <- predict(model, day2_training)
    - showDF(Output)
    - TP <- nrow(where(Output, Output$payment_type == 1 & Output$prediction == 1))
	- FP <- nrow(where(Output, Output$payment_type == 0 & Output$prediction == 1))
	- Precision = TP/(TP+FP)
	- FN <- nrow(where(Output, Output$payment_type == 1 & Output$prediction == 0))
	- Recall = TP/(TP+FN)
	- cat("Precision of the model = ", Precision)
	#Precision of the model is = 0.5742579 
	- cat("Recall of the model = ", Recall)
	#Recall of the model is = 0.9194347

Q2)
	- model <- spark.glm(day1_training, trip_distance ~fare_amount +pickup_longitude +pickup_latitude +dropoff_latitude +dropoff_longitude, family = "gaussian")
	- Output <- predict(model, day2_training)
	- showDF(Output, 20)
    - RMSE = select(Output, sqrt(avg((Output$trip_distance-Output$prediction)^2)))
    - cat("RMSE of the model = ", showDF(RMSE))
    #RMSE of the model = 1.379230312182878|
    - MAPE = select(Output, avg(abs(Output$trip_distance-Output$prediction)))
    - cat("MAPE of the model = ", showDF(MAPE))
    #MAPE of the model = 0.5461974149337597||

First 20 rows:
+---------+-------------------+-------------------+---------------+-------------+----------------+---------------+---------+------------------+-----------------+----------------+------------+-----------+---------+-------+----------+------------+------------+-----+-------------------+
|vendor_id|    pickup_datetime|   dropoff_datetime|passenger_count|trip_distance|pickup_longitude|pickup_latitude|rate_code|store_and_fwd_flag|dropoff_longitude|dropoff_latitude|payment_type|fare_amount|surcharge|mta_tax|tip_amount|tolls_amount|total_amount|label|         prediction|
+---------+-------------------+-------------------+---------------+-------------+----------------+---------------+---------+------------------+-----------------+----------------+------------+-----------+---------+-------+----------+------------+------------+-----+-------------------+
|      CMT|2014-08-02 23:16:34|2014-08-02 23:23:50|              1|          1.3|      -73.980162|      40.743206|        1|                 Y|       -73.965414|       40.755026|         0.0|        7.0|      0.5|    0.5|       0.0|         0.0|         8.0|  1.3| 1.1964938287982134|
|      CMT|2014-08-02 21:03:59|2014-08-02 21:13:08|              1|          1.0|      -73.994692|      40.727707|        1|                 Y|        -73.98684|        40.73937|         0.0|        7.0|      0.5|    0.5|       0.0|         0.0|         8.0|  1.0| 1.1336015212262849|
|      CMT|2014-08-02 21:49:18|2014-08-02 21:57:36|              1|          1.6|      -73.982328|      40.773345|        1|                 Y|       -73.960542|        40.77262|         0.0|        8.0|      0.5|    0.5|       0.0|         0.0|         9.0|  1.6| 1.5480397635850833|
|      CMT|2014-08-02 04:11:34|2014-08-02 04:31:10|              1|          8.6|        -73.9871|      40.733363|        1|                 Y|       -73.938968|       40.821745|         0.0|       26.0|      0.5|    0.5|       0.0|         0.0|        27.0|  8.6|  7.107655587426211|
|      CMT|2014-08-02 00:10:14|2014-08-02 00:37:43|              2|          6.0|      -73.980572|      40.767423|        1|                 Y|        -74.01211|       40.707162|         0.0|       23.5|      0.5|    0.5|       0.0|         0.0|        24.5|  6.0|  6.036811221348702|
|      CMT|2014-08-02 12:03:57|2014-08-02 12:10:45|              1|          1.5|      -73.978071|      40.754908|        1|                 Y|        -73.99212|        40.74877|         0.0|        6.5|      0.0|    0.5|       0.0|         0.0|         7.0|  1.5| 1.0047768299157012|
|      CMT|2014-08-02 22:56:28|2014-08-02 22:58:40|              1|          0.7|      -74.007858|      40.723299|        1|                 Y|       -74.007073|       40.732999|         0.0|        4.0|      0.5|    0.5|       0.0|         0.0|         5.0|  0.7|0.18734932977726526|
|      CMT|2014-08-02 14:49:31|2014-08-02 14:54:48|              1|          1.2|      -73.985844|      40.756006|        1|                 Y|        -74.00003|       40.755815|         0.0|        5.5|      0.0|    0.5|       0.0|         0.0|         6.0|  1.2|   0.70741002083611|
|      CMT|2014-08-02 23:05:14|2014-08-02 23:12:11|              1|          0.9|      -74.000673|      40.742092|        1|                 Y|       -73.986503|       40.739424|         0.0|        6.0|      0.5|    0.5|       0.0|         0.0|         7.0|  0.9| 0.8343078668148562|
|      CMT|2014-08-02 00:11:02|2014-08-02 00:17:05|              2|          0.7|      -74.001644|      40.730565|        1|                 Y|       -73.998973|       40.739193|         0.0|        6.0|      0.5|    0.5|       0.0|         0.0|         7.0|  0.7| 0.8167862235577585|
|      CMT|2014-08-02 16:40:32|2014-08-02 17:07:01|              2|          6.8|      -74.013702|      40.714131|        1|                 Y|       -73.982338|       40.777179|         0.0|       21.5|      0.0|    0.5|       0.0|         0.0|        22.0|  6.8|  5.596069164854103|
|      CMT|2014-08-02 14:01:19|2014-08-02 14:11:37|              1|          2.9|      -73.984795|      40.747944|        1|                 Y|        -73.96148|       40.777266|         0.0|       10.5|      0.0|    0.5|       0.0|         0.0|        11.0|  2.9|  2.306275542919738|
|      CMT|2014-08-02 01:10:13|2014-08-02 01:19:23|              1|          4.6|      -73.987059|      40.720721|        1|                 Y|       -73.956198|       40.767076|         0.0|       14.5|      0.5|    0.5|       0.0|         0.0|        15.5|  4.6| 3.4935558655333834|
|      CMT|2014-08-02 15:01:07|2014-08-02 15:18:39|              3|          3.0|      -73.995664|      40.759424|        1|                 Y|       -73.972409|        40.76161|         0.0|       12.0|      0.0|    0.5|       0.0|         0.0|        12.5|  3.0|  2.715637971847573|
|      CMT|2014-08-02 16:06:23|2014-08-02 16:10:10|              1|          0.9|      -73.987204|      40.750836|        1|                 Y|       -73.979533|       40.761271|         0.0|        5.0|      0.0|    0.5|       0.0|         0.0|         5.5|  0.9| 0.5896675600829893|
|      CMT|2014-08-02 13:19:56|2014-08-02 13:27:22|              4|          1.5|      -74.013055|      40.716384|        1|                 Y|       -74.016966|       40.707525|         0.0|        6.5|      0.0|    0.5|       0.0|         0.0|         7.0|  1.5|   0.87609834866831|
|      CMT|2014-08-02 21:37:15|2014-08-02 21:41:58|              1|          0.9|       -73.98658|      40.766799|        1|                 Y|       -73.987686|       40.776491|         0.0|        5.5|      0.5|    0.5|       0.0|         0.0|         6.5|  0.9| 0.7672949881793611|
|      CMT|2014-08-02 12:28:18|2014-08-02 12:33:25|              1|          1.0|      -73.988378|      40.749039|        1|                 Y|       -73.979689|       40.752643|         0.0|        5.5|      0.0|    0.5|       0.0|         0.0|         6.0|  1.0| 0.7219638235876458|
|      CMT|2014-08-02 11:49:09|2014-08-02 12:00:03|              2|          1.7|      -73.989825|      40.761487|        1|                 Y|       -73.977704|        40.75397|         0.0|        8.0|      0.0|    0.5|       0.0|         0.0|         8.5|  1.7| 1.4855378111129793|
|      CMT|2014-08-02 15:32:46|2014-08-02 15:46:48|              2|          3.1|      -73.962289|       40.77917|        1|                 Y|       -73.977804|       40.753746|         0.0|       11.0|      0.0|    0.5|       0.0|         0.0|        11.5|  3.1|  2.399840691769202|
+---------+-------------------+-------------------+---------------+-------------+----------------+---------------+---------+------------------+-----------------+----------------+------------+-----------+---------+-------+----------+------------+------------+-----+-------------------+
only showing top 20 rows



Q3)
	- model <- spark.kmeans(data = day1_training, ~pickup_latitude +pickup_longitude +dropoff_latitude +dropoff_longitude, k=5, maxIter = 20, initMode = "random") 
	- output <- predict(model, day1_training) 
	- showDF(output, 20)
    - summary(model) # prints the centroid
    - showDF(mean(groupBy(output, output$prediction))) # Another way to see cetroids

First 20 rows
+---------+-------------------+-------------------+---------------+-------------+----------------+---------------+---------+------------------+-----------------+----------------+------------+-----------+---------+-------+----------+------------+------------+----------+
|vendor_id|    pickup_datetime|   dropoff_datetime|passenger_count|trip_distance|pickup_longitude|pickup_latitude|rate_code|store_and_fwd_flag|dropoff_longitude|dropoff_latitude|payment_type|fare_amount|surcharge|mta_tax|tip_amount|tolls_amount|total_amount|prediction|
+---------+-------------------+-------------------+---------------+-------------+----------------+---------------+---------+------------------+-----------------+----------------+------------+-----------+---------+-------+----------+------------+------------+----------+
|      VTS|2014-08-01 00:15:00|2014-08-01 00:23:00|              2|         1.51|       -73.98306|       40.75001|        1|                  |        -73.99025|        40.75819|         CSH|        7.5|      0.5|    0.5|       0.0|         0.0|         8.5|         1|
|      VTS|2014-08-01 00:16:00|2014-08-01 00:26:00|              1|         3.03|      -73.937835|      40.758457|        1|                  |        -74.01309|        40.70208|         CSH|       11.0|      0.5|    0.5|       0.0|         0.0|        12.0|         1|
|      VTS|2014-08-01 00:02:00|2014-08-01 00:27:00|              5|         4.14|       -73.99263|       40.72469|        1|                  |        -73.96062|        40.76476|         CSH|       19.5|      0.5|    0.5|       0.0|         0.0|        20.5|         1|
|      VTS|2014-08-01 00:22:00|2014-08-01 00:25:00|              1|         0.35|       -73.99438|       40.72126|        1|                  |        -73.98929|        40.71819|         CSH|        4.0|      0.5|    0.5|       0.0|         0.0|         5.0|         1|
|      VTS|2014-08-01 00:05:00|2014-08-01 00:08:00|              5|         0.69|      -73.953645|      40.774972|        1|                  |       -73.953248|        40.76824|         CSH|        4.5|      0.5|    0.5|       0.0|         0.0|         5.5|         4|
|      VTS|2014-08-01 00:01:00|2014-08-01 00:04:00|              1|         0.57|      -73.983277|      40.749587|        1|                  |       -73.991358|        40.74988|         CSH|        4.5|      0.5|    0.5|       0.0|         0.0|         5.5|         1|
|      VTS|2014-08-01 00:03:00|2014-08-01 00:07:00|              1|         0.79|       -73.95553|       40.76876|        1|                  |        -73.96268|        40.76245|         CSH|        5.0|      0.5|    0.5|       0.0|         0.0|         6.0|         4|
|      VTS|2014-08-01 00:06:00|2014-08-01 00:12:00|              5|         1.05|      -74.007975|      40.742022|        1|                  |       -74.000395|       40.732597|         CSH|        6.0|      0.5|    0.5|       0.0|         0.0|         7.0|         1|
|      VTS|2014-08-01 00:02:00|2014-08-01 00:08:00|              1|          0.8|       -73.98361|       40.72996|        1|                  |        -73.98943|        40.72328|         CSH|        6.0|      0.5|    0.5|       0.0|         0.0|         7.0|         1|
|      VTS|2014-08-01 00:03:00|2014-08-01 00:10:00|              5|         1.31|       -73.98417|      40.737392|        1|                  |       -73.991575|        40.74889|         CSH|        7.0|      0.5|    0.5|       0.0|         0.0|         8.0|         1|
|      VTS|2014-08-01 00:00:00|2014-08-01 00:03:00|              1|         0.49|      -73.997572|      40.724267|        1|                  |       -73.997572|       40.724267|         CSH|        4.0|      0.5|    0.5|       0.0|         0.0|         5.0|         1|
|      VTS|2014-08-01 00:00:00|2014-08-01 00:04:00|              6|         0.96|      -73.990823|      40.760925|        1|                  |       -73.991023|       40.750475|         CSH|        5.0|      0.5|    0.5|       0.0|         0.0|         6.0|         1|
|      VTS|2014-08-01 00:00:00|2014-08-01 00:04:00|              1|         0.79|      -73.986467|      40.766857|        1|                  |       -73.995285|       40.760387|         CSH|        5.0|      0.5|    0.5|       0.0|         0.0|         6.0|         1|
|      VTS|2014-08-01 00:00:00|2014-08-01 00:11:00|              4|         2.38|      -73.997572|       40.72075|        1|                  |         -73.9788|       40.750592|         CSH|       10.5|      0.5|    0.5|       0.0|         0.0|        11.5|         1|
|      VTS|2014-08-01 00:00:00|2014-08-01 00:03:00|              2|         0.93|      -73.973985|      40.748287|        1|                  |       -73.982882|       40.741197|         CSH|        5.0|      0.5|    0.5|       0.0|         0.0|         6.0|         1|
|      VTS|2014-08-01 00:01:00|2014-08-01 00:05:00|              6|         1.01|      -73.977658|      40.789135|        1|                  |       -73.977658|       40.789135|         CSH|        5.0|      0.5|    0.5|       0.0|         0.0|         6.0|         4|
|      VTS|2014-08-01 00:02:00|2014-08-01 00:09:00|              5|         1.65|        -73.9861|       40.74113|        1|                  |        -73.97893|        40.72412|         CSH|        7.5|      0.5|    0.5|       0.0|         0.0|         8.5|         1|
|      VTS|2014-08-01 23:57:00|2014-08-02 00:05:00|              1|         1.44|      -73.970125|       40.80237|        1|                  |       -73.974777|       40.788002|         CSH|        7.5|      0.5|    0.5|       0.0|         0.0|         8.5|         4|
|      VTS|2014-08-01 00:02:00|2014-08-01 00:07:00|              6|          0.7|      -73.984837|      40.758802|        1|                  |       -73.993972|       40.758975|         CSH|        5.0|      0.5|    0.5|       0.0|         0.0|         6.0|         1|
|      VTS|2014-08-01 00:01:00|2014-08-01 00:07:00|              1|         1.48|      -73.976868|      40.764362|        1|                  |       -73.978837|       40.782297|         CSH|        7.0|      0.5|    0.5|       0.0|         0.0|         8.0|         4|
+---------+-------------------+-------------------+---------------+-------------+----------------+---------------+---------+------------------+-----------------+----------------+------------+-----------+---------+-------+----------+------------+------------+----------+


Centroids

> summary(model)
$k
[1] 5
$coefficients
  pickup_latitude pickup_longitude dropoff_latitude dropoff_longitude
1        18.05356        -32.77209         22.69421         -41.19841
2        40.73989        -73.98987         40.73631         -73.98985
3        40.69599        -73.85377         40.70896         -73.88291
4         0.00000          0.00000          0.00000           0.00000
5        40.76823        -73.96658         40.77333         -73.96087
$size
$size[[1]]
[1] 4812
$size[[2]]
[1] 489184
$size[[3]]
[1] 32070
$size[[4]]
[1] 20330
$size[[5]]
[1] 352656
$cluster
SparkDataFrame[prediction:int]
$is.loaded
[1] FALSE
$clusterSize
[1] 5


Another way to see centroid:

> showDF(mean(groupBy(output, output$prediction)))
+----------+--------------------+------------------+---------------------+--------------------+------------------+----------------------+---------------------+------------------+-------------------+-------------------+------------------+-------------------+------------------+---------------+
|prediction|avg(passenger_count)|avg(trip_distance)|avg(pickup_longitude)|avg(pickup_latitude)|    avg(rate_code)|avg(dropoff_longitude)|avg(dropoff_latitude)|  avg(fare_amount)|     avg(surcharge)|       avg(mta_tax)|   avg(tip_amount)|  avg(tolls_amount)| avg(total_amount)|avg(prediction)|
+----------+--------------------+------------------+---------------------+--------------------+------------------+----------------------+---------------------+------------------+-------------------+-------------------+------------------+-------------------+------------------+---------------+
|         1|  1.7012003663243278|2.3158352276444125|   -73.98985677289112|  40.739920701555974|1.0157445869039052|    -73.98982991983004|    40.73635426620627|11.442678256034542| 0.3899473408778701| 0.4975796428337803|1.3861042061882713|0.08007485935762391|13.796623724406189|            1.0|
|         3|   1.727201180521397| 2.703943925233646|                  0.0|                 0.0| 1.134874569601574|                   0.0|                  0.0|13.589942941465816| 0.3881947860304968|0.49129365469749137|1.6324308903098865|0.25797442203639964| 16.35983669454011|            3.0|
|         4|  1.6794383194954856|2.9270550905131394|   -73.96653012894154|  40.768265588880034|1.0073045687582234|    -73.96081554632269|   40.773364087433514|12.505529297672519| 0.3622964021596116|0.49935064198539086|1.4662908897055653|0.37441909396126066|15.207948595798584|            4.0|
|         2|  1.7943872778297474|14.172805737449336|   -73.85367930371069|   40.69588563648273|1.5816651075771748|    -73.88287546242597|   40.708935244777095|42.376012472715935|0.19957280947926412|  0.495385095104459| 4.585305269722501| 2.4480823199251387| 50.10435796694735|            2.0|
|         0|  1.6816292601828762|2.3046259351620946|   -32.77208819368245|  18.053555530756444| 1.213216957605985|            -41.198412|   22.694212105985038|14.627310889443057|0.34497090606816294|0.48794679966749793|1.6889983374896096| 0.4121280133000831|17.561354945968404|            0.0|
+----------+--------------------+------------------+---------------------+--------------------+------------------+----------------------+---------------------+------------------+-------------------+-------------------+------------------+-------------------+------------------+---------------+
